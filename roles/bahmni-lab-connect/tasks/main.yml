- name: add bahmni configuration file
  template:
      src=bahmni-emr-installer.conf.j2
      dest=/etc/bahmni-installer/bahmni-emr-installer.conf
      mode=644
      owner={{ bahmni_user }}
      group={{ bahmni_group }}

- name: Check if bahmni-lab-connect rpm needs an update
  command: yum list installed bahmni-lab-connect
  register: installed_bahmni_lab_connect
  ignore_errors: true

- name: Uninstall bahmni-lab-connect rpm
  yum: name="bahmni-lab-connect" state=absent
  when: installed_bahmni_lab_connect.stdout.find("{{ bahmni_lab_connect_version }}") == -1

- name: Stop openmrs and bahmni-emr
  service: name=openmrs state=stopped

- name: Install bahmni-lab-connect from bahmni-repo
  yum: name="bahmni-lab-connect-{{ bahmni_lab_connect_version }}" state=present

- name: Start openmrs and bahmni-emr
  service: name=openmrs state=started
  when: passive is not defined or passive != 'yes'
